import time
from pprint import pprint
from GameAPIClass import GameAPI
from GameMapClass import GameMap
from AlgoClass import Algo
from BotClass import Bot
import threading


if __name__ == '__main__':
    server = GameAPI()
    #if server.deathmatch_registration_request():
    #maps = server.map_request()
    visual = GameMap('https://datsblack.datsteam.dev/json/map/6586ae233e7ba8.12192069.json')
    #threading.Thread(target=visual.run).start()
    #my_ships, enemy_ships, tick, zone = server.scan_around_ships_requests()
    #while len(my_ships) > 0:
    counter = 0
    while True:
        #my_ships, enemy_ships, tick, zone = server.scan_around_ships_requests()
        my_ships = [{'cannonCooldown': 3,
                          'cannonCooldownLeft': 0,
                          'cannonRadius': 20,
                          'cannonShootSuccessCount': 0,
                          'direction': 'north',
                          'hp': 4,
                          'id': 2752,
                          'maxChangeSpeed': 5,
                          'maxHp': 4,
                          'maxSpeed': 10,
                          'minSpeed': -1,
                          'scanRadius': 60,
                          'size': 4,
                          'speed': 0,
                          'x': 1428,
                          'y': 1336},
                         {'cannonCooldown': 3,
                          'cannonCooldownLeft': 0,
                          'cannonRadius': 20,
                          'cannonShootSuccessCount': 0,
                          'direction': 'north',
                          'hp': 2,
                          'id': 2759,
                          'maxChangeSpeed': 5,
                          'maxHp': 2,
                          'maxSpeed': 10,
                          'minSpeed': -1,
                          'scanRadius': 60,
                          'size': 2,
                          'speed': 0,
                          'x': 1449,
                          'y': 1336},
                         {'cannonCooldown': 3,
                          'cannonCooldownLeft': 0,
                          'cannonRadius': 20,
                          'cannonShootSuccessCount': 0,
                          'direction': 'north',
                          'hp': 2,
                          'id': 2757,
                          'maxChangeSpeed': 5,
                          'maxHp': 2,
                          'maxSpeed': 10,
                          'minSpeed': -1,
                          'scanRadius': 60,
                          'size': 2,
                          'speed': 0,
                          'x': 1443,
                          'y': 1336},
                         {'cannonCooldown': 3,
                          'cannonCooldownLeft': 0,
                          'cannonRadius': 20,
                          'cannonShootSuccessCount': 0,
                          'direction': 'north',
                          'hp': 3,
                          'id': 2758,
                          'maxChangeSpeed': 5,
                          'maxHp': 3,
                          'maxSpeed': 10,
                          'minSpeed': -1,
                          'scanRadius': 60,
                          'size': 3,
                          'speed': 0,
                          'x': 1446,
                          'y': 1336},
                         {'cannonCooldown': 3,
                          'cannonCooldownLeft': 0,
                          'cannonRadius': 20,
                          'cannonShootSuccessCount': 0,
                          'direction': 'north',
                          'hp': 2,
                          'id': 2760,
                          'maxChangeSpeed': 5,
                          'maxHp': 2,
                          'maxSpeed': 10,
                          'minSpeed': -1,
                          'scanRadius': 60,
                          'size': 2,
                          'speed': 0,
                          'x': 1452,
                          'y': 1335},
                         {'cannonCooldown': 3,
                          'cannonCooldownLeft': 0,
                          'cannonRadius': 20,
                          'cannonShootSuccessCount': 0,
                          'direction': 'north',
                          'hp': 5,
                          'id': 2753,
                          'maxChangeSpeed': 5,
                          'maxHp': 5,
                          'maxSpeed': 10,
                          'minSpeed': -1,
                          'scanRadius': 60,
                          'size': 5,
                          'speed': 0,
                          'x': 1431,
                          'y': 1336},
                         {'cannonCooldown': 3,
                          'cannonCooldownLeft': 0,
                          'cannonRadius': 20,
                          'cannonShootSuccessCount': 0,
                          'direction': 'north',
                          'hp': 3,
                          'id': 2754,
                          'maxChangeSpeed': 5,
                          'maxHp': 3,
                          'maxSpeed': 10,
                          'minSpeed': -1,
                          'scanRadius': 60,
                          'size': 3,
                          'speed': 0,
                          'x': 1434,
                          'y': 1336},
                         {'cannonCooldown': 3,
                          'cannonCooldownLeft': 0,
                          'cannonRadius': 20,
                          'cannonShootSuccessCount': 0,
                          'direction': 'north',
                          'hp': 4,
                          'id': 2755,
                          'maxChangeSpeed': 5,
                          'maxHp': 4,
                          'maxSpeed': 10,
                          'minSpeed': -1,
                          'scanRadius': 60,
                          'size': 4,
                          'speed': 0,
                          'x': 1437,
                          'y': 1337},
                         {'cannonCooldown': 3,
                          'cannonCooldownLeft': 0,
                          'cannonRadius': 20,
                          'cannonShootSuccessCount': 0,
                          'direction': 'north',
                          'hp': 2,
                          'id': 2751,
                          'maxChangeSpeed': 5,
                          'maxHp': 2,
                          'maxSpeed': 10,
                          'minSpeed': -1,
                          'scanRadius': 60,
                          'size': 2,
                          'speed': 0,
                          'x': 1425,
                          'y': 1336},
                         {'cannonCooldown': 3,
                          'cannonCooldownLeft': 0,
                          'cannonRadius': 20,
                          'cannonShootSuccessCount': 0,
                          'direction': 'north',
                          'hp': 3,
                          'id': 2756,
                          'maxChangeSpeed': 5,
                          'maxHp': 3,
                          'maxSpeed': 10,
                          'minSpeed': -1,
                          'scanRadius': 60,
                          'size': 3,
                          'speed': 0,
                          'x': 1440,
                          'y': 1335}]

        enemy_ships = [{'cannonCooldown': 3,
                     'cannonCooldownLeft': 0,
                     'cannonRadius': 20,
                     'cannonShootSuccessCount': 0,
                     'direction': 'north',
                     'hp': 4,
                     'id': 2752,
                     'maxChangeSpeed': 5,
                     'maxHp': 4,
                     'maxSpeed': 10,
                     'minSpeed': -1,
                     'scanRadius': 60,
                     'size': 4,
                     'speed': 0,
                     'x': 1438,
                     'y': 1356},
                    {'cannonCooldown': 3,
                     'cannonCooldownLeft': 0,
                     'cannonRadius': 20,
                     'cannonShootSuccessCount': 0,
                     'direction': 'north',
                     'hp': 2,
                     'id': 2759,
                     'maxChangeSpeed': 5,
                     'maxHp': 2,
                     'maxSpeed': 10,
                     'minSpeed': -1,
                     'scanRadius': 60,
                     'size': 2,
                     'speed': 0,
                     'x': 1459,
                     'y': 1346},
                    {'cannonCooldown': 3,
                     'cannonCooldownLeft': 0,
                     'cannonRadius': 20,
                     'cannonShootSuccessCount': 0,
                     'direction': 'north',
                     'hp': 2,
                     'id': 2757,
                     'maxChangeSpeed': 5,
                     'maxHp': 2,
                     'maxSpeed': 10,
                     'minSpeed': -1,
                     'scanRadius': 60,
                     'size': 2,
                     'speed': 0,
                     'x': 1453,
                     'y': 1346},
                    {'cannonCooldown': 3,
                     'cannonCooldownLeft': 0,
                     'cannonRadius': 20,
                     'cannonShootSuccessCount': 0,
                     'direction': 'north',
                     'hp': 3,
                     'id': 2758,
                     'maxChangeSpeed': 5,
                     'maxHp': 3,
                     'maxSpeed': 10,
                     'minSpeed': -1,
                     'scanRadius': 60,
                     'size': 3,
                     'speed': 0,
                     'x': 1456,
                     'y': 1346},
                    {'cannonCooldown': 3,
                     'cannonCooldownLeft': 0,
                     'cannonRadius': 20,
                     'cannonShootSuccessCount': 0,
                     'direction': 'north',
                     'hp': 2,
                     'id': 2760,
                     'maxChangeSpeed': 5,
                     'maxHp': 2,
                     'maxSpeed': 10,
                     'minSpeed': -1,
                     'scanRadius': 60,
                     'size': 2,
                     'speed': 0,
                     'x': 1462,
                     'y': 1345},
                    {'cannonCooldown': 3,
                     'cannonCooldownLeft': 0,
                     'cannonRadius': 20,
                     'cannonShootSuccessCount': 0,
                     'direction': 'north',
                     'hp': 5,
                     'id': 2753,
                     'maxChangeSpeed': 5,
                     'maxHp': 5,
                     'maxSpeed': 10,
                     'minSpeed': -1,
                     'scanRadius': 60,
                     'size': 5,
                     'speed': 0,
                     'x': 1441,
                     'y': 1346},
                    {'cannonCooldown': 3,
                     'cannonCooldownLeft': 0,
                     'cannonRadius': 20,
                     'cannonShootSuccessCount': 0,
                     'direction': 'north',
                     'hp': 3,
                     'id': 2754,
                     'maxChangeSpeed': 5,
                     'maxHp': 3,
                     'maxSpeed': 10,
                     'minSpeed': -1,
                     'scanRadius': 60,
                     'size': 3,
                     'speed': 0,
                     'x': 1444,
                     'y': 1346},
                    {'cannonCooldown': 3,
                     'cannonCooldownLeft': 0,
                     'cannonRadius': 20,
                     'cannonShootSuccessCount': 0,
                     'direction': 'north',
                     'hp': 4,
                     'id': 2755,
                     'maxChangeSpeed': 5,
                     'maxHp': 4,
                     'maxSpeed': 10,
                     'minSpeed': -1,
                     'scanRadius': 60,
                     'size': 4,
                     'speed': 0,
                     'x': 1447,
                     'y': 1347},
                    {'cannonCooldown': 3,
                     'cannonCooldownLeft': 0,
                     'cannonRadius': 20,
                     'cannonShootSuccessCount': 0,
                     'direction': 'north',
                     'hp': 2,
                     'id': 2751,
                     'maxChangeSpeed': 5,
                     'maxHp': 2,
                     'maxSpeed': 10,
                     'minSpeed': -1,
                     'scanRadius': 60,
                     'size': 2,
                     'speed': 0,
                     'x': 1445,
                     'y': 1346},
                    {'cannonCooldown': 3,
                     'cannonCooldownLeft': 0,
                     'cannonRadius': 20,
                     'cannonShootSuccessCount': 0,
                     'direction': 'north',
                     'hp': 3,
                     'id': 2756,
                     'maxChangeSpeed': 5,
                     'maxHp': 3,
                     'maxSpeed': 10,
                     'minSpeed': -1,
                     'scanRadius': 60,
                     'size': 3,
                     'speed': 0,
                     'x': 1450,
                     'y': 1345}]
        visual.set_ships(my_ships)
        tick_changes = []
        for ship in my_ships:
            bot = Bot(ship)
            attack_coordinates = bot.attack_opponents(enemy_ships)
            visual.render_shots(attack_coordinates)
            changes = Algo.setup_changes(ship['id'], speed=3, rotate=90, x=attack_coordinates[1], y=attack_coordinates[0])
            tick_changes.append(changes)
        #server.ships_control_request(tick_changes)
        #my_ships, enemy_ships, tick, zone = server.scan_around_ships_requests()
        my_new_ships = [{'cannonCooldown': 3,
                     'cannonCooldownLeft': 0,
                     'cannonRadius': 20,
                     'cannonShootSuccessCount': 0,
                     'direction': 'north',
                     'hp': 4,
                     'id': 2752,
                     'maxChangeSpeed': 5,
                     'maxHp': 4,
                     'maxSpeed': 10,
                     'minSpeed': -1,
                     'scanRadius': 60,
                     'size': 4,
                     'speed': 0,
                     'x': 1478,
                     'y': 1376},{'cannonCooldown': 3,
                     'cannonCooldownLeft': 0,
                     'cannonRadius': 20,
                     'cannonShootSuccessCount': 0,
                     'direction': 'north',
                     'hp': 2,
                     'id': 2759,
                     'maxChangeSpeed': 5,
                     'maxHp': 2,
                     'maxSpeed': 10,
                     'minSpeed': -1,
                     'scanRadius': 60,
                     'size': 2,
                     'speed': 0,
                     'x': 1489,
                     'y': 1386},{'cannonCooldown': 3,
                     'cannonCooldownLeft': 0,
                     'cannonRadius': 20,
                     'cannonShootSuccessCount': 0,
                     'direction': 'north',
                     'hp': 2,
                     'id': 2757,
                     'maxChangeSpeed': 5,
                     'maxHp': 2,
                     'maxSpeed': 10,
                     'minSpeed': -1,
                     'scanRadius': 60,
                     'size': 2,
                     'speed': 0,
                     'x': 1483,
                     'y': 1386}, {'cannonCooldown': 3,
                     'cannonCooldownLeft': 0,
                     'cannonRadius': 20,
                     'cannonShootSuccessCount': 0,
                     'direction': 'north',
                     'hp': 3,
                     'id': 2758,
                     'maxChangeSpeed': 5,
                     'maxHp': 3,
                     'maxSpeed': 10,
                     'minSpeed': -1,
                     'scanRadius': 60,
                     'size': 3,
                     'speed': 0,
                     'x': 1426,
                     'y': 1356}, {'cannonCooldown': 3,
                     'cannonCooldownLeft': 0,
                     'cannonRadius': 20,
                     'cannonShootSuccessCount': 0,
                     'direction': 'north',
                     'hp': 2,
                     'id': 2760,
                     'maxChangeSpeed': 5,
                     'maxHp': 2,
                     'maxSpeed': 10,
                     'minSpeed': -1,
                     'scanRadius': 60,
                     'size': 2,
                     'speed': 0,
                     'x': 1462,
                     'y': 1395}, {'cannonCooldown': 3,
                     'cannonCooldownLeft': 0,
                     'cannonRadius': 20,
                     'cannonShootSuccessCount': 0,
                     'direction': 'north',
                     'hp': 5,
                     'id': 2753,
                     'maxChangeSpeed': 5,
                     'maxHp': 5,
                     'maxSpeed': 10,
                     'minSpeed': -1,
                     'scanRadius': 60,
                     'size': 5,
                     'speed': 0,
                     'x': 1421,
                     'y': 1356},{'cannonCooldown': 3,
                     'cannonCooldownLeft': 0,
                     'cannonRadius': 20,
                     'cannonShootSuccessCount': 0,
                     'direction': 'north',
                     'hp': 3,
                     'id': 2754,
                     'maxChangeSpeed': 5,
                     'maxHp': 3,
                     'maxSpeed': 10,
                     'minSpeed': -1,
                     'scanRadius': 60,
                     'size': 3,
                     'speed': 0,
                     'x': 1434,
                     'y': 1396},{'cannonCooldown': 3,
                     'cannonCooldownLeft': 0,
                     'cannonRadius': 20,
                     'cannonShootSuccessCount': 0,
                     'direction': 'north',
                     'hp': 4,
                     'id': 2755,
                     'maxChangeSpeed': 5,
                     'maxHp': 4,
                     'maxSpeed': 10,
                     'minSpeed': -1,
                     'scanRadius': 60,
                     'size': 4,
                     'speed': 0,
                     'x': 1427,
                     'y': 1317},{'cannonCooldown': 3,
                     'cannonCooldownLeft': 0,
                     'cannonRadius': 20,
                     'cannonShootSuccessCount': 0,
                     'direction': 'north',
                     'hp': 2,
                     'id': 2751,
                     'maxChangeSpeed': 5,
                     'maxHp': 2,
                     'maxSpeed': 10,
                     'minSpeed': -1,
                     'scanRadius': 60,
                     'size': 2,
                     'speed': 0,
                     'x': 1435,
                     'y': 1366}, {'cannonCooldown': 3,
                     'cannonCooldownLeft': 0,
                     'cannonRadius': 20,
                     'cannonShootSuccessCount': 0,
                     'direction': 'north',
                     'hp': 3,
                     'id': 2756,
                     'maxChangeSpeed': 5,
                     'maxHp': 3,
                     'maxSpeed': 10,
                     'minSpeed': -1,
                     'scanRadius': 60,
                     'size': 3,
                     'speed': 0,
                     'x': 1340,
                     'y': 1235}]
        print("я тут")
        counter+=1
        visual.render(my_new_ships,enemy_ships, counter)








